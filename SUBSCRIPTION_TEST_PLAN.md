# 🧪 ForgeFit Subscription System Test Plan

## ✅ Current Status
The subscription system has been fully implemented with:
- **Firebase Admin SDK**: Connected to track workout counts
- **Real-time Event System**: Profile page updates immediately after workout generation
- **Subscription Limits**: 3 free workouts, then subscription required
- **Stripe Integration**: Checkout and webhook processing
- **UI Components**: Subscription modal and profile management

## 🎯 Test Objectives
1. Verify 3-workout limit enforcement
2. Test real-time workout count updates
3. Confirm subscription modal appears correctly
4. Test Stripe checkout flow
5. Verify workout images appear for all workouts

---

## 📋 Step-by-Step Testing Guide

### **Phase 1: Initial Setup & Authentication**
1. **Open the app**: `http://localhost:3000`
2. **Sign in/Create account**: Use the authentication system
3. **Complete profile setup**: Fill out age, gender, goals, experience
4. **Navigate to Profile page**: Check initial subscription status
   - Should show: `Free Plan (0/3 workouts used)`

### **Phase 2: First Workout Generation**
1. **Go to Dashboard**
2. **Generate first workout**:
   - Fill out workout preferences (duration, type, equipment)
   - Click "Generate Workout Plan"
   - **✅ Expected**: Workout generates successfully with image
3. **Check Profile page**:
   - **✅ Expected**: Should show `Free Plan (1/3 workouts used)`
   - **✅ Expected**: Count updates immediately without page refresh

### **Phase 3: Second Workout Generation**
1. **Return to Dashboard**
2. **Generate second workout** (different preferences)
3. **Check Profile page**:
   - **✅ Expected**: Should show `Free Plan (2/3 workouts used)`
   - **✅ Expected**: Real-time update occurs

### **Phase 4: Third Workout Generation**
1. **Generate third workout**
2. **Check Profile page**:
   - **✅ Expected**: Should show `Free Plan (3/3 workouts used)`
   - **✅ Expected**: All workout images should be visible

### **Phase 5: Subscription Limit Test (Critical)**
1. **Attempt fourth workout generation**
2. **✅ Expected Results**:
   - API should return 403 error
   - Subscription modal should appear immediately
   - Modal should show "You've reached your free workout limit"
   - Modal should offer $9.99/month subscription

### **Phase 6: Stripe Checkout Test**
1. **Click "Subscribe Now" in modal**
2. **✅ Expected**: Redirect to Stripe checkout page
3. **Use Stripe test card**: `4242 4242 4242 4242`
4. **Complete checkout**
5. **✅ Expected**: 
   - Webhook should update user subscription status
   - Redirect back to dashboard
   - Profile should show "Premium Plan"

### **Phase 7: Unlimited Access Test**
1. **Generate additional workouts** (4th, 5th, etc.)
2. **✅ Expected**: 
   - No limits for subscribed users
   - All workouts generate successfully
   - Images appear correctly

---

## 🔍 Debug Information

### **Console Logs to Watch For**:
```
✅ Successfully updated workout count: 0 -> 1
✅ Verified new workout count: 1
Workout generated detected, refreshing subscription data
📊 User data from Firestore: { workoutCount: 1, isSubscribed: false }
✅ Setting new subscription data: { workoutCount: 1, isSubscribed: false }
```

### **Network Requests to Monitor**:
- `POST /api/generate-plan`: Should return 200 for first 3 workouts, 403 for 4th
- `POST /api/create-checkout-session`: When subscribing
- `POST /api/stripe-webhook`: When payment completes

### **Firebase Admin SDK Check**:
- Look for: `Firebase Admin SDK initialized successfully`
- If missing: Firebase credentials not properly configured

---

## 🚨 Troubleshooting

### **Issue: Workout count not updating**
- Check browser console for Firebase Admin SDK logs
- Verify Firebase credentials are set in environment variables
- Check Network tab for API call success

### **Issue: Images missing on workouts**
- Check if `json.imageUrl` is being generated by Gemini
- Verify conditional spreading: `...(json.imageUrl && { image: json.imageUrl })`
- Check Firebase save operation for undefined values

### **Issue: Subscription modal not appearing**
- Verify API returns exactly `{ error: "limit-exceeded" }` on 403
- Check `isSubscriptionModalOpen` state in React DevTools
- Confirm workout count reaches 3 before testing

### **Issue: Real-time updates not working**
- Check for `workoutGenerated` event emission in dashboard
- Verify event listener in profile page
- Test manual page refresh as fallback

---

## 🎉 Success Criteria

**✅ Subscription System Working If:**
1. Workout count tracks accurately (0→1→2→3)
2. Profile page updates in real-time without refresh
3. 4th workout attempt shows subscription modal
4. Stripe checkout completes successfully
5. Subscribed users can generate unlimited workouts
6. All workout images appear correctly

**🎊 Ready for Production When:**
- All test phases pass
- No console errors during normal operation
- Payment flow works with test cards
- Webhook processes subscription events correctly

---

## 📞 Next Steps After Testing

1. **If tests pass**: Deploy to production with real Stripe keys
2. **If issues found**: Check the troubleshooting section above
3. **Production setup**: 
   - Switch to live Stripe keys
   - Configure production webhook endpoint
   - Test with real payment method

**The subscription system is now ready for testing! 🚀**
